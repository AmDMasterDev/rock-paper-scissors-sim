<!DOCTYPE html>
<html>
  <style>
    * {
      background-color: rgb(89, 89, 89);
    }

    #gameCanvas {
      position: absolute;
      top: 10%;
      left: 10%;
    }
  </style>
  <body>
    <canvas id="gameCanvas"></canvas>

    <script>
      class GameObject {
        constructor(x, y, type) {
          this.x = x;
          this.y = y;
          this.type = type; // "rock", "paper", or "scissors"
          this.dx = Math.random() * 2 - 1; // Horizontal velocity
          this.dy = Math.random() * 2 - 1; // Vertical velocity
          this.squishing = false; // Whether the object is currently squishing
          this.squishStart = 0; // The time at which the object started squishing
        }
      }

      let rockImage = new Image();
      rockImage.src = "https://i.imgur.com/eFxVRgX.png"; // Replace with the URL of your rock image

      let paperImage = new Image();
      paperImage.src = "https://i.imgur.com/ocQ6qCw.png"; // Replace with the URL of your paper image

      let scissorsImage = new Image();
      scissorsImage.src = "https://i.imgur.com/gFIasFb.png"; // Replace with the URL of your scissors image

      window.onload = function () {
        let num = window.prompt(
          "How many objects of each type would you like to spawn?"
        );

        let canvas = document.getElementById("gameCanvas");
        canvas.width = window.innerWidth * 0.8;
        canvas.height = window.innerHeight * 0.8;

        if (num !== null) {
          spawnObjects(num);
        }
      };

      let objects = [];

      function spawnObjects(num) {
        objects = []; // Clear the existing objects

        let canvas = document.getElementById("gameCanvas");
        let spawnAreaX = canvas.width * 0.8; // 80% of canvas width
        let spawnAreaY = canvas.height * 0.8; // 80% of canvas height
        let offsetX = canvas.width * 0.1; // 10% of canvas width
        let offsetY = canvas.height * 0.1; // 10% of canvas height

        for (let i = 0; i < num; i++) {
          // Spawn a rock
          objects.push(
            new GameObject(
              Math.random() * spawnAreaX + offsetX,
              Math.random() * spawnAreaY + offsetY,
              "rock"
            )
          );

          // Spawn a paper
          objects.push(
            new GameObject(
              Math.random() * spawnAreaX + offsetX,
              Math.random() * spawnAreaY + offsetY,
              "paper"
            )
          );

          // Spawn a scissors
          objects.push(
            new GameObject(
              Math.random() * spawnAreaX + offsetX,
              Math.random() * spawnAreaY + offsetY,
              "scissors"
            )
          );
        }
      }

      function lerp(start, end, t) {
        return start * (1 - t) + end * t;
      }

      function checkCollision() {
        for (let i = 0; i < objects.length; i++) {
          for (let j = i + 1; j < objects.length; j++) {
            let obj1 = objects[i];
            let obj2 = objects[j];
            let distance = Math.sqrt(
              Math.pow(obj2.x - obj1.x, 2) + Math.pow(obj2.y - obj1.y, 2)
            );

            if (distance < 40) {
              // Considering the radius of the objects
              let angle = Math.atan2(obj2.y - obj1.y, obj2.x - obj1.x);

              obj1.dx = -Math.cos(angle);
              obj1.dy = -Math.sin(angle);

              obj2.dx = Math.cos(angle);
              obj2.dy = Math.sin(angle);

              obj1.squishing = true;
              obj1.squishStart = Date.now();

              obj2.squishing = true;
              obj2.squishStart = Date.now();

              setTimeout(() => {
                obj1.squishing = false;
                obj2.squishing = false;
              }, 100);

              fight(obj1, obj2);
            }
          }
        }
      }

      function fight(obj1, obj2) {
        if (
          (obj1.type === "rock" && obj2.type === "scissors") ||
          (obj1.type === "scissors" && obj2.type === "paper") ||
          (obj1.type === "paper" && obj2.type === "rock")
        ) {
          obj2.type = obj1.type;
        } else if (obj2.type !== obj1.type) {
          obj1.type = obj2.type;
        }
      }

      function moveAndDraw() {
        let canvas = document.getElementById("gameCanvas");
        let ctx = canvas.getContext("2d");

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let obj of objects) {
          // Move the object in its current direction
          obj.x += obj.dx;
          obj.y += obj.dy;

          // If the object hits the edge of the canvas, make it bounce back
          if (obj.x - 20 < 0 || obj.x + 20 > canvas.width) {
            obj.dx = -obj.dx;
          }
          if (obj.y - 20 < 0 || obj.y + 20 > canvas.height) {
            obj.dy = -obj.dy;
          }

          let size;
          if (obj.squishing) {
            let t = (Date.now() - obj.squishStart) / 200; // How far along in the squishing animation we are
            size = lerp(50, 30, t); // Interpolate between 40 and 60 based on t
          } else {
            size = 50;
          }

          // Draw the object
          //   let size = obj.squishing ? 60 : 40; // The object is 50% bigger when squishing
          if (obj.type === "rock") {
            ctx.drawImage(
              rockImage,
              obj.x - size / 2,
              obj.y - size / 2,
              size,
              size
            );
          } else if (obj.type === "paper") {
            ctx.drawImage(
              paperImage,
              obj.x - size / 2,
              obj.y - size / 2,
              size,
              size
            );
          } else if (obj.type === "scissors") {
            ctx.drawImage(
              scissorsImage,
              obj.x - size / 2,
              obj.y - size / 2,
              size,
              size
            );
          }

          // Draw the object's type above it, adjusted for proximity to the top
          //   ctx.font = "20px Arial";
          //   ctx.fillStyle = "black";
          //   ctx.textAlign = "center";
          //   let yOffset = Math.max(10, obj.y - 20);
          //   ctx.fillText(obj.type, obj.x, yOffset);
        }
      }

      // Call these functions every frame
      setInterval(function () {
        moveAndDraw();
        checkCollision();
      }, 1000 / 60); // 60 FPS
    </script>
  </body>
</html>
